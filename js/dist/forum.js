(()=>{var e={n:s=>{var r=s&&s.__esModule?()=>s.default:()=>s;return e.d(r,{a:r}),r},d:(s,r)=>{for(var t in r)e.o(r,t)&&!e.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:r[t]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};(()=>{"use strict";const s=flarum.core.compat["forum/app"];var r=e.n(s);const t=flarum.core.compat["common/extend"];function n(e,s){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,s){return e.__proto__=s,e},n(e,s)}const a=flarum.core.compat["common/components/Modal"];var o=e.n(a);const i=flarum.core.compat["common/components/Button"];var u=e.n(i);const c=flarum.core.compat["common/utils/Stream"];var d=e.n(c),l=function(e){function s(){return e.apply(this,arguments)||this}var t,a;a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,n(t,a);var o=s.prototype;return o.oninit=function(s){e.prototype.oninit.call(this,s),this.password=d()(""),this.passwordConfirm=d()(""),this.loading=!1},o.className=function(){return"ForcePasswordChangeModal Modal--small"},o.title=function(){return"修改密码"},o.getPasswordSettings=function(){return{strongPasswordEnabled:r().forum.attribute("jiushutech-force-password-change.strong_password_enabled")||!1,minLength:r().forum.attribute("jiushutech-force-password-change.min_password_length")||8,requireUppercase:r().forum.attribute("jiushutech-force-password-change.require_uppercase")||!1,requireLowercase:r().forum.attribute("jiushutech-force-password-change.require_lowercase")||!1,requireNumbers:r().forum.attribute("jiushutech-force-password-change.require_numbers")||!1,requireSpecialChars:r().forum.attribute("jiushutech-force-password-change.require_special_chars")||!1}},o.checkPasswordRequirement=function(e,s){var r=this.getPasswordSettings();switch(s){case"minLength":return e.length>=r.minLength;case"uppercase":return/[A-Z]/.test(e);case"lowercase":return/[a-z]/.test(e);case"numbers":return/[0-9]/.test(e);case"specialChars":return/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~`]/.test(e);default:return!1}},o.validatePassword=function(e){var s=this.getPasswordSettings();return e.length<s.minLength?{valid:!1,message:"密码长度至少为 "+s.minLength+" 个字符。"}:s.strongPasswordEnabled?s.requireUppercase&&!/[A-Z]/.test(e)?{valid:!1,message:"密码必须包含至少一个大写字母。"}:s.requireLowercase&&!/[a-z]/.test(e)?{valid:!1,message:"密码必须包含至少一个小写字母。"}:s.requireNumbers&&!/[0-9]/.test(e)?{valid:!1,message:"密码必须包含至少一个数字。"}:s.requireSpecialChars&&!/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~`]/.test(e)?{valid:!1,message:"密码必须包含至少一个特殊字符。"}:{valid:!0}:{valid:!0}},o.renderPasswordRequirements=function(){var e=this.getPasswordSettings(),s=this.password(),r=[];return r.push({text:"至少 "+e.minLength+" 个字符",met:this.checkPasswordRequirement(s,"minLength"),key:"minLength"}),e.strongPasswordEnabled&&(e.requireUppercase&&r.push({text:"至少一个大写字母 (A-Z)",met:this.checkPasswordRequirement(s,"uppercase"),key:"uppercase"}),e.requireLowercase&&r.push({text:"至少一个小写字母 (a-z)",met:this.checkPasswordRequirement(s,"lowercase"),key:"lowercase"}),e.requireNumbers&&r.push({text:"至少一个数字 (0-9)",met:this.checkPasswordRequirement(s,"numbers"),key:"numbers"}),e.requireSpecialChars&&r.push({text:"至少一个特殊字符 (!@#$%^&*...)",met:this.checkPasswordRequirement(s,"specialChars"),key:"specialChars"})),m("div",{className:"PasswordRequirements"},m("p",{className:"PasswordRequirements-title"},"密码要求："),m("ul",{className:"PasswordRequirements-list"},r.map(function(e){return m("li",{key:e.key,className:"PasswordRequirement "+(e.met?"is-met":"is-unmet")},m("span",{className:"PasswordRequirement-icon"},e.met?"✓":"○"),m("span",{className:"PasswordRequirement-text"},e.text))})))},o.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("p",{className:"helpText"},"出于安全原因，您必须先修改密码才能继续使用。"),this.renderPasswordRequirements(),m("div",{className:"Form-group"},m("input",{className:"FormControl",name:"password",type:"password",placeholder:"新密码",bidi:this.password,disabled:this.loading,oninput:function(){return m.redraw()}})),m("div",{className:"Form-group"},m("input",{className:"FormControl",name:"passwordConfirm",type:"password",placeholder:"确认密码",bidi:this.passwordConfirm,disabled:this.loading})),m("div",{className:"Form-group"},u().component({className:"Button Button--primary Button--block",type:"submit",loading:this.loading},"修改密码"))),m("style",null,"\n                    .PasswordRequirements {\n                        margin: 15px 0;\n                        padding: 12px;\n                        background: #f8f9fa;\n                        border-radius: 4px;\n                        border-left: 3px solid #3f51b5;\n                    }\n\n                    .PasswordRequirements-title {\n                        margin: 0 0 8px 0;\n                        font-weight: 600;\n                        font-size: 14px;\n                        color: #333;\n                    }\n\n                    .PasswordRequirements-list {\n                        list-style: none;\n                        margin: 0;\n                        padding: 0;\n                    }\n\n                    .PasswordRequirement {\n                        display: flex;\n                        align-items: center;\n                        margin: 6px 0;\n                        font-size: 13px;\n                        transition: all 0.2s ease;\n                    }\n\n                    .PasswordRequirement-icon {\n                        display: inline-flex;\n                        align-items: center;\n                        justify-content: center;\n                        width: 20px;\n                        height: 20px;\n                        margin-right: 8px;\n                        border-radius: 50%;\n                        font-weight: bold;\n                        font-size: 14px;\n                        flex-shrink: 0;\n                    }\n\n                    .PasswordRequirement.is-met .PasswordRequirement-icon {\n                        background: #4caf50;\n                        color: white;\n                    }\n\n                    .PasswordRequirement.is-unmet .PasswordRequirement-icon {\n                        background: #e0e0e0;\n                        color: #999;\n                    }\n\n                    .PasswordRequirement.is-met .PasswordRequirement-text {\n                        color: #4caf50;\n                        font-weight: 500;\n                    }\n\n                    .PasswordRequirement.is-unmet .PasswordRequirement-text {\n                        color: #666;\n                    }\n                "))},o.onsubmit=function(e){var s=this;if(e.preventDefault(),this.password()===this.passwordConfirm()){var t=this.validatePassword(this.password());t.valid?(this.loading=!0,r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/force-password-change",body:{password:this.password()}}).then(function(){r().session.user&&r().session.user.pushAttributes({forcePasswordChange:!1}),r().alerts.show({type:"success"},"密码修改成功！"),s.hide()}).catch(function(e){throw s.loading=!1,m.redraw(),e})):r().alerts.show({type:"error"},t.message)}else r().alerts.show({type:"error"},"两次输入的密码不一致。")},s}(o());function p(){var e,s=null==(e=r().session)?void 0:e.user;s&&s.attribute("forcePasswordChange")&&r().modal.show(l,{user:s})}l.isDismissible=!1,r().initializers.add("jiushutech/force-password-change",function(){(0,t.extend)(r(),"mount",function(){setTimeout(function(){p()},100)}),r().session&&r().session.user&&p()})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map
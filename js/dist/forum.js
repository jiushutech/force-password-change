(()=>{var o={n:s=>{var r=s&&s.__esModule?()=>s.default:()=>s;return o.d(r,{a:r}),r},d:(s,r)=>{for(var t in r)o.o(r,t)&&!o.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:r[t]})},o:(o,s)=>Object.prototype.hasOwnProperty.call(o,s)};(()=>{"use strict";const s=flarum.core.compat["forum/app"];var r=o.n(s);const t=flarum.core.compat["common/extend"];function a(o,s){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,s){return o.__proto__=s,o},a(o,s)}const e=flarum.core.compat["common/components/Modal"];var n=o.n(e);const c=flarum.core.compat["common/components/Button"];var i=o.n(c);const u=flarum.core.compat["common/utils/Stream"];var d=o.n(u),l=function(o){function s(){return o.apply(this,arguments)||this}var t,e;e=o,(t=s).prototype=Object.create(e.prototype),t.prototype.constructor=t,a(t,e);var n=s.prototype;return n.oninit=function(s){o.prototype.oninit.call(this,s),this.password=d()(""),this.passwordConfirm=d()(""),this.loading=!1},n.className=function(){return"ForcePasswordChangeModal Modal--small"},n.title=function(){return r().translator.trans("jiushutech-force-password-change.forum.modal.title")},n.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("p",{className:"helpText"},r().translator.trans("jiushutech-force-password-change.forum.modal.help")),m("div",{className:"Form-group"},m("input",{className:"FormControl",name:"password",type:"password",placeholder:r().translator.trans("jiushutech-force-password-change.forum.modal.new_password_placeholder"),bidi:this.password,disabled:this.loading})),m("div",{className:"Form-group"},m("input",{className:"FormControl",name:"passwordConfirm",type:"password",placeholder:r().translator.trans("jiushutech-force-password-change.forum.modal.confirm_password_placeholder"),bidi:this.passwordConfirm,disabled:this.loading})),m("div",{className:"Form-group"},i().component({className:"Button Button--primary Button--block",type:"submit",loading:this.loading},r().translator.trans("jiushutech-force-password-change.forum.modal.submit_button")))))},n.onsubmit=function(o){var s=this;o.preventDefault(),this.password()===this.passwordConfirm()?this.password().length<8?r().alerts.show({type:"error"},r().translator.trans("jiushutech-force-password-change.forum.modal.password_too_short")):(this.loading=!0,r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/force-password-change",body:{password:this.password()}}).then(function(){r().session.user&&r().session.user.pushAttributes({forcePasswordChange:!1}),r().alerts.show({type:"success"},r().translator.trans("jiushutech-force-password-change.forum.modal.success")),s.hide()}).catch(function(o){throw s.loading=!1,m.redraw(),o})):r().alerts.show({type:"error"},r().translator.trans("jiushutech-force-password-change.forum.modal.passwords_not_match"))},s}(n());function p(){var o,s=null==(o=r().session)?void 0:o.user;s&&s.attribute("forcePasswordChange")&&r().modal.show(l,{user:s})}l.isDismissible=!1,r().initializers.add("jiushutech/force-password-change",function(){(0,t.extend)(r(),"mount",function(){setTimeout(function(){p()},100)}),r().session&&r().session.user&&p()})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map
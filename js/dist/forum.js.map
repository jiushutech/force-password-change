{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@jiushutech/force-password-change/webpack/bootstrap","webpack://@jiushutech/force-password-change/webpack/runtime/compat get default export","webpack://@jiushutech/force-password-change/webpack/runtime/define property getters","webpack://@jiushutech/force-password-change/webpack/runtime/hasOwnProperty shorthand","webpack://@jiushutech/force-password-change/external root \"flarum.core.compat['forum/app']\"","webpack://@jiushutech/force-password-change/external root \"flarum.core.compat['common/extend']\"","webpack://@jiushutech/force-password-change/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@jiushutech/force-password-change/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@jiushutech/force-password-change/external root \"flarum.core.compat['common/components/Button']\"","webpack://@jiushutech/force-password-change/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@jiushutech/force-password-change/./src/forum/components/ForcePasswordChangeModal.js","webpack://@jiushutech/force-password-change/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@jiushutech/force-password-change/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/Stream'];","import app from 'flarum/forum/app';\nimport Modal from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\nimport Stream from 'flarum/common/utils/Stream';\n\nexport default class ForcePasswordChangeModal extends Modal {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.password = Stream('');\n        this.passwordConfirm = Stream('');\n        this.loading = false;\n    }\n\n    static isDismissible = false;\n\n    className() {\n        return 'ForcePasswordChangeModal Modal--small';\n    }\n\n    title() {\n        return '修改密码';\n    }\n\n    getPasswordSettings() {\n        return {\n            strongPasswordEnabled: app.forum.attribute('jiushutech-force-password-change.strong_password_enabled') || false,\n            minLength: app.forum.attribute('jiushutech-force-password-change.min_password_length') || 8,\n            requireUppercase: app.forum.attribute('jiushutech-force-password-change.require_uppercase') || false,\n            requireLowercase: app.forum.attribute('jiushutech-force-password-change.require_lowercase') || false,\n            requireNumbers: app.forum.attribute('jiushutech-force-password-change.require_numbers') || false,\n            requireSpecialChars: app.forum.attribute('jiushutech-force-password-change.require_special_chars') || false,\n        };\n    }\n\n    checkPasswordRequirement(password, requirement) {\n        const settings = this.getPasswordSettings();\n\n        switch (requirement) {\n            case 'minLength':\n                return password.length >= settings.minLength;\n            case 'uppercase':\n                return /[A-Z]/.test(password);\n            case 'lowercase':\n                return /[a-z]/.test(password);\n            case 'numbers':\n                return /[0-9]/.test(password);\n            case 'specialChars':\n                return /[!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?~`]/.test(password);\n            default:\n                return false;\n        }\n    }\n\n    validatePassword(password) {\n        const settings = this.getPasswordSettings();\n\n        // 检查最小长度\n        if (password.length < settings.minLength) {\n            return {\n                valid: false,\n                message: `密码长度至少为 ${settings.minLength} 个字符。`\n            };\n        }\n\n        // 如果未启用强密码，只检查最小长度\n        if (!settings.strongPasswordEnabled) {\n            return { valid: true };\n        }\n\n        // 检查大写字母\n        if (settings.requireUppercase && !/[A-Z]/.test(password)) {\n            return {\n                valid: false,\n                message: '密码必须包含至少一个大写字母。'\n            };\n        }\n\n        // 检查小写字母\n        if (settings.requireLowercase && !/[a-z]/.test(password)) {\n            return {\n                valid: false,\n                message: '密码必须包含至少一个小写字母。'\n            };\n        }\n\n        // 检查数字\n        if (settings.requireNumbers && !/[0-9]/.test(password)) {\n            return {\n                valid: false,\n                message: '密码必须包含至少一个数字。'\n            };\n        }\n\n        // 检查特殊字符\n        if (settings.requireSpecialChars && !/[!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?~`]/.test(password)) {\n            return {\n                valid: false,\n                message: '密码必须包含至少一个特殊字符。'\n            };\n        }\n\n        return { valid: true };\n    }\n\n    renderPasswordRequirements() {\n        const settings = this.getPasswordSettings();\n        const password = this.password();\n        const requirements = [];\n\n        // 最小长度要求（始终显示）\n        requirements.push({\n            text: `至少 ${settings.minLength} 个字符`,\n            met: this.checkPasswordRequirement(password, 'minLength'),\n            key: 'minLength'\n        });\n\n        // 只有启用强密码时才显示其他要求\n        if (settings.strongPasswordEnabled) {\n            if (settings.requireUppercase) {\n                requirements.push({\n                    text: '至少一个大写字母 (A-Z)',\n                    met: this.checkPasswordRequirement(password, 'uppercase'),\n                    key: 'uppercase'\n                });\n            }\n\n            if (settings.requireLowercase) {\n                requirements.push({\n                    text: '至少一个小写字母 (a-z)',\n                    met: this.checkPasswordRequirement(password, 'lowercase'),\n                    key: 'lowercase'\n                });\n            }\n\n            if (settings.requireNumbers) {\n                requirements.push({\n                    text: '至少一个数字 (0-9)',\n                    met: this.checkPasswordRequirement(password, 'numbers'),\n                    key: 'numbers'\n                });\n            }\n\n            if (settings.requireSpecialChars) {\n                requirements.push({\n                    text: '至少一个特殊字符 (!@#$%^&*...)',\n                    met: this.checkPasswordRequirement(password, 'specialChars'),\n                    key: 'specialChars'\n                });\n            }\n        }\n\n        return (\n            <div className=\"PasswordRequirements\">\n                <p className=\"PasswordRequirements-title\">密码要求：</p>\n                <ul className=\"PasswordRequirements-list\">\n                    {requirements.map(req => (\n                        <li\n                            key={req.key}\n                            className={`PasswordRequirement ${req.met ? 'is-met' : 'is-unmet'}`}\n                        >\n                            <span className=\"PasswordRequirement-icon\">\n                                {req.met ? '✓' : '○'}\n                            </span>\n                            <span className=\"PasswordRequirement-text\">\n                                {req.text}\n                            </span>\n                        </li>\n                    ))}\n                </ul>\n            </div>\n        );\n    }\n\n    content() {\n        return (\n            <div className=\"Modal-body\">\n                <div className=\"Form Form--centered\">\n                    <p className=\"helpText\">\n                        出于安全原因，您必须先修改密码才能继续使用。\n                    </p>\n\n                    {this.renderPasswordRequirements()}\n\n                    <div className=\"Form-group\">\n                        <input\n                            className=\"FormControl\"\n                            name=\"password\"\n                            type=\"password\"\n                            placeholder=\"新密码\"\n                            bidi={this.password}\n                            disabled={this.loading}\n                            oninput={() => m.redraw()}\n                        />\n                    </div>\n                    <div className=\"Form-group\">\n                        <input\n                            className=\"FormControl\"\n                            name=\"passwordConfirm\"\n                            type=\"password\"\n                            placeholder=\"确认密码\"\n                            bidi={this.passwordConfirm}\n                            disabled={this.loading}\n                        />\n                    </div>\n                    <div className=\"Form-group\">\n                        {Button.component(\n                            {\n                                className: 'Button Button--primary Button--block',\n                                type: 'submit',\n                                loading: this.loading,\n                            },\n                            '修改密码'\n                        )}\n                    </div>\n                </div>\n                <style>{`\n                    .PasswordRequirements {\n                        margin: 15px 0;\n                        padding: 12px;\n                        background: #f8f9fa;\n                        border-radius: 4px;\n                        border-left: 3px solid #3f51b5;\n                    }\n\n                    .PasswordRequirements-title {\n                        margin: 0 0 8px 0;\n                        font-weight: 600;\n                        font-size: 14px;\n                        color: #333;\n                    }\n\n                    .PasswordRequirements-list {\n                        list-style: none;\n                        margin: 0;\n                        padding: 0;\n                    }\n\n                    .PasswordRequirement {\n                        display: flex;\n                        align-items: center;\n                        margin: 6px 0;\n                        font-size: 13px;\n                        transition: all 0.2s ease;\n                    }\n\n                    .PasswordRequirement-icon {\n                        display: inline-flex;\n                        align-items: center;\n                        justify-content: center;\n                        width: 20px;\n                        height: 20px;\n                        margin-right: 8px;\n                        border-radius: 50%;\n                        font-weight: bold;\n                        font-size: 14px;\n                        flex-shrink: 0;\n                    }\n\n                    .PasswordRequirement.is-met .PasswordRequirement-icon {\n                        background: #4caf50;\n                        color: white;\n                    }\n\n                    .PasswordRequirement.is-unmet .PasswordRequirement-icon {\n                        background: #e0e0e0;\n                        color: #999;\n                    }\n\n                    .PasswordRequirement.is-met .PasswordRequirement-text {\n                        color: #4caf50;\n                        font-weight: 500;\n                    }\n\n                    .PasswordRequirement.is-unmet .PasswordRequirement-text {\n                        color: #666;\n                    }\n                `}</style>\n            </div>\n        );\n    }\n\n    onsubmit(e) {\n        e.preventDefault();\n\n        if (this.password() !== this.passwordConfirm()) {\n            app.alerts.show(\n                { type: 'error' },\n                '两次输入的密码不一致。'\n            );\n            return;\n        }\n\n        // 使用强密码验证\n        const validation = this.validatePassword(this.password());\n        if (!validation.valid) {\n            app.alerts.show(\n                { type: 'error' },\n                validation.message\n            );\n            return;\n        }\n\n        this.loading = true;\n\n        app.request({\n            method: 'POST',\n            url: app.forum.attribute('apiUrl') + '/force-password-change',\n            body: {\n                password: this.password()\n            }\n        })\n        .then(() => {\n            // Update local user data\n            if (app.session.user) {\n                app.session.user.pushAttributes({\n                    forcePasswordChange: false\n                });\n            }\n\n            app.alerts.show(\n                { type: 'success' },\n                '密码修改成功！'\n            );\n\n            this.hide();\n        })\n        .catch((error) => {\n            this.loading = false;\n            m.redraw();\n            throw error;\n        });\n    }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport ForcePasswordChangeModal from './components/ForcePasswordChangeModal';\n\napp.initializers.add('jiushutech/force-password-change', () => {\n    extend(app, 'mount', function () {\n        // Check after the app is fully mounted\n        setTimeout(() => {\n            checkForcePasswordChange();\n        }, 100);\n    });\n\n    // Also check when session changes\n    if (app.session && app.session.user) {\n        checkForcePasswordChange();\n    }\n});\n\nfunction checkForcePasswordChange() {\n    const user = app.session?.user;\n\n    if (user && user.attribute('forcePasswordChange')) {\n        app.modal.show(ForcePasswordChangeModal, {\n            user: user\n        });\n    }\n}\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","ForcePasswordChangeModal","_Modal","apply","arguments","create","constructor","_proto","oninit","vnode","this","password","Stream","passwordConfirm","loading","className","title","getPasswordSettings","strongPasswordEnabled","app","attribute","minLength","requireUppercase","requireLowercase","requireNumbers","requireSpecialChars","checkPasswordRequirement","requirement","settings","length","test","validatePassword","valid","message","renderPasswordRequirements","requirements","push","text","met","m","map","req","content","name","type","placeholder","bidi","disabled","oninput","redraw","Button","onsubmit","_this","preventDefault","validation","method","url","body","then","user","pushAttributes","forcePasswordChange","show","hide","error","Modal","checkForcePasswordChange","_app$session","isDismissible","add","extend","setTimeout"],"ignoreList":[],"sourceRoot":""}
{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@jiushutech/force-password-change/webpack/bootstrap","webpack://@jiushutech/force-password-change/webpack/runtime/compat get default export","webpack://@jiushutech/force-password-change/webpack/runtime/define property getters","webpack://@jiushutech/force-password-change/webpack/runtime/hasOwnProperty shorthand","webpack://@jiushutech/force-password-change/external root \"flarum.core.compat['forum/app']\"","webpack://@jiushutech/force-password-change/external root \"flarum.core.compat['common/extend']\"","webpack://@jiushutech/force-password-change/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@jiushutech/force-password-change/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@jiushutech/force-password-change/external root \"flarum.core.compat['common/components/Button']\"","webpack://@jiushutech/force-password-change/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@jiushutech/force-password-change/./src/forum/components/ForcePasswordChangeModal.js","webpack://@jiushutech/force-password-change/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@jiushutech/force-password-change/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/Stream'];","import app from 'flarum/forum/app';\nimport Modal from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\nimport Stream from 'flarum/common/utils/Stream';\n\nexport default class ForcePasswordChangeModal extends Modal {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.password = Stream('');\n        this.passwordConfirm = Stream('');\n        this.loading = false;\n    }\n\n    static isDismissible = false;\n\n    className() {\n        return 'ForcePasswordChangeModal Modal--small';\n    }\n\n    title() {\n        return app.translator.trans('jiushutech-force-password-change.forum.modal.title');\n    }\n\n    content() {\n        return (\n            <div className=\"Modal-body\">\n                <div className=\"Form Form--centered\">\n                    <p className=\"helpText\">\n                        {app.translator.trans('jiushutech-force-password-change.forum.modal.help')}\n                    </p>\n                    <div className=\"Form-group\">\n                        <input\n                            className=\"FormControl\"\n                            name=\"password\"\n                            type=\"password\"\n                            placeholder={app.translator.trans('jiushutech-force-password-change.forum.modal.new_password_placeholder')}\n                            bidi={this.password}\n                            disabled={this.loading}\n                        />\n                    </div>\n                    <div className=\"Form-group\">\n                        <input\n                            className=\"FormControl\"\n                            name=\"passwordConfirm\"\n                            type=\"password\"\n                            placeholder={app.translator.trans('jiushutech-force-password-change.forum.modal.confirm_password_placeholder')}\n                            bidi={this.passwordConfirm}\n                            disabled={this.loading}\n                        />\n                    </div>\n                    <div className=\"Form-group\">\n                        {Button.component(\n                            {\n                                className: 'Button Button--primary Button--block',\n                                type: 'submit',\n                                loading: this.loading,\n                            },\n                            app.translator.trans('jiushutech-force-password-change.forum.modal.submit_button')\n                        )}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    onsubmit(e) {\n        e.preventDefault();\n\n        if (this.password() !== this.passwordConfirm()) {\n            app.alerts.show(\n                { type: 'error' },\n                app.translator.trans('jiushutech-force-password-change.forum.modal.passwords_not_match')\n            );\n            return;\n        }\n\n        if (this.password().length < 8) {\n            app.alerts.show(\n                { type: 'error' },\n                app.translator.trans('jiushutech-force-password-change.forum.modal.password_too_short')\n            );\n            return;\n        }\n\n        this.loading = true;\n\n        app.request({\n            method: 'POST',\n            url: app.forum.attribute('apiUrl') + '/force-password-change',\n            body: {\n                password: this.password()\n            }\n        })\n        .then(() => {\n            // Update local user data\n            if (app.session.user) {\n                app.session.user.pushAttributes({\n                    forcePasswordChange: false\n                });\n            }\n\n            app.alerts.show(\n                { type: 'success' },\n                app.translator.trans('jiushutech-force-password-change.forum.modal.success')\n            );\n\n            this.hide();\n        })\n        .catch((error) => {\n            this.loading = false;\n            m.redraw();\n            throw error;\n        });\n    }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport ForcePasswordChangeModal from './components/ForcePasswordChangeModal';\n\napp.initializers.add('jiushutech/force-password-change', () => {\n    extend(app, 'mount', function () {\n        // Check after the app is fully mounted\n        setTimeout(() => {\n            checkForcePasswordChange();\n        }, 100);\n    });\n\n    // Also check when session changes\n    if (app.session && app.session.user) {\n        checkForcePasswordChange();\n    }\n});\n\nfunction checkForcePasswordChange() {\n    const user = app.session?.user;\n\n    if (user && user.attribute('forcePasswordChange')) {\n        app.modal.show(ForcePasswordChangeModal, {\n            user: user\n        });\n    }\n}\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","ForcePasswordChangeModal","_Modal","apply","arguments","create","constructor","_proto","oninit","vnode","this","password","Stream","passwordConfirm","loading","className","title","app","trans","content","m","name","type","placeholder","bidi","disabled","Button","onsubmit","_this","preventDefault","length","show","method","url","attribute","body","then","user","pushAttributes","forcePasswordChange","hide","error","redraw","Modal","checkForcePasswordChange","_app$session","isDismissible","add","extend","setTimeout"],"ignoreList":[],"sourceRoot":""}